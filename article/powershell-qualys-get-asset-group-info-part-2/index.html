<!doctype html>
<html class="no-js" lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="author" content="Josh Rickard">
        <meta name="description" content="Lets Automate It">
        <meta name="keywords" content="blog,powershell,security,pwsh,python,active,directory,grouppolicy,windows,microsoft">
        <meta name="generator" content="Hugo 0.49" />
        <title> Powershell Qualys Get Asset Group Info Part 2 | Lets Automate It</title>
        <meta name="description" content="Powershell Qualys Get Asset Group Info Part 2 - Lets Automate It">
        <meta itemprop="name" content="Powershell Qualys Get Asset Group Info Part 2">
        <meta itemprop="description" content="Powershell Qualys Get Asset Group Info Part 2 - Lets Automate It">
        <meta property="og:title" content="Powershell Qualys Get Asset Group Info Part 2">
        <meta property="og:description" content="Powershell Qualys Get Asset Group Info Part 2 - Lets Automate It">
        <meta property="og:image" content="https://letsautomate.it/images/default.jpg">
        <meta property="og:url" content="https://letsautomate.it/article/powershell-qualys-get-asset-group-info-part-2/">
        <meta property="og:site_name" content="Lets Automate It">
        <meta property="og:type" content="article">
        <link rel="icon" type="image/png" href="https://letsautomate.it/favicon-32x32.png" sizes="32x32">
        <link rel="icon" type="image/png" href="https://letsautomate.it/favicon-16x16.png" sizes="16x16">

	

        <link rel="stylesheet" href="https://letsautomate.it/dist/theme.css">

        

        
            
        
    </head>
    <body class="bilberry-hugo-theme">
        
<nav>

    <div class="container">
        <ul class="topnav">
            
                
                    <li><a href="/page/projects/">Projects</a></li>
                
            
                
                    <li><a href="/page/presentations/">Presentations</a></li>
                
            
                
                    <li><a href="/page/about/">About</a></li>
                
            
        </ul>

        
            <div id="search-box" class="search">
                <i class="fa fa-search"></i>
                <input id="search" type="text" placeholder="Search ...">
            </div>
        
    </div>
</nav>


        <header>
    <div class="container">
        <div class="logo">
            <a href="/" class="logo">
                
                    <img src="/images/default.jpg" alt="">
                

                <span class="overlay"><i class="fa fa-home"></i></span>
            </a>
        </div>
        <div class="titles">
            <h3 class="title"><a href="/">Lets Automate It</a></h3>
            
                <span class="subtitle">from Josh Rickard</span>
            
        </div>

    

        
        <div class="toggler">
        
            <i class="fa fa-bars" aria-hidden="true"></i>
        </div>
    </div>
</header>


        <div class="main container">
            
     
    <div class="article-wrapper u-cf single">
        
            <a class="bubble" href="/article/powershell-qualys-get-asset-group-info-part-2/">
    <i class="fa fa-fw fa-pencil"></i>
</a>

<article class="default article">
    

    <div class="content">
    <h3><a href="/article/powershell-qualys-get-asset-group-info-part-2/">Powershell Qualys Get Asset Group Info Part 2</a></h3>
    <div class="meta">
        <span class="date moment">2018-08-07</span>
        
        
            <span class="author"><a href="/author/josh-rickard">Josh Rickard</a></span>
        
         <div class="social-media"></div>
<ul class="share-buttons">
    <li>
        <a href="https://www.facebook.com/sharer/sharer.php?u=https://letsautomate.it%2farticle%2fpowershell-qualys-get-asset-group-info-part-2%2f" target="_blank" title="Share on Facebook">
            <i class="fa fa-facebook" aria-hidden="true"></i>
            <span class="sr-only">Share on Facebook</span>
        </a>
    </li>
    
    <li>
        <a href="//twitter.com/share?url=https://letsautomate.it%2farticle%2fpowershell-qualys-get-asset-group-info-part-2%2f&amp;text=Powershell%20Qualys%20Get%20Asset%20Group%20Info%20Part%202&amp;hashtags=%5barchive%5d&amp;via=Josh%20Rickard" target="_blank" title="Tweet">
            <i class="fa fa-twitter" aria-hidden="true"></i>
            <span class="sr-only">Tweet</span>
        </a>
    </li>
    <li>
        <a href="//www.linkedin.com/shareArticle?url=https://letsautomate.it%2farticle%2fpowershell-qualys-get-asset-group-info-part-2%2f&amp;title=Powershell%20Qualys%20Get%20Asset%20Group%20Info%20Part%202" target="_blank" title="LinkedIn">
            <i class="fa fa-linkedin" aria-hidden="true"></i>
            <span class="sr-only">LinkedIn</span>
        </a>
    </li>
    <li>
        <a href="http://www.reddit.com/submit?url=https://letsautomate.it%2farticle%2fpowershell-qualys-get-asset-group-info-part-2%2f" target="_blank" title="Reddit">
            <i class="fa fa-reddit" aria-hidden="true"></i>
            <span class="sr-only">Reddit</span>
        </a>
    </li>
    <li>
        <a href="mailto:?subject=Check out this post by Josh%20Rickard&amp;body=https://letsautomate.it%2farticle%2fpowershell-qualys-get-asset-group-info-part-2%2f" target="_blank" title="Email">
            <i class="fa fa-envelope" aria-hidden="true"></i>
            <span class="sr-only">Email</span>
        </a>
    </li>
</ul>


<style>
    ul.share-buttons {
        list-style: none;
        padding: 0;
    }

    ul.share-buttons li {
        display: inline;
    }

    ul.share-buttons .sr-only {
        position: absolute;
        clip: rect(1px 1px 1px 1px);
        clip: rect(1px, 1px, 1px, 1px);
        padding: 0;
        border: 0;
        height: 1px;
        width: 1px;
        overflow: hidden;
    }
</style>
    </div>

    
        <p>Today I decided to write another post regarding PowerShell and Qualys Vulnerability Management API.  This post will focus on gathering information about your enrolled Asset Groups.   You can find the complete script on GitHub: <a href="https://github.com/MSAdministrator/POSH-Guard/blob/master/Get-QualysAssetGroupInformation" target="_blank"><a href="https://github.com/MSAdministrator/POSH-Guard/blob/master/Get-QualysAssetGroupInformation">https://github.com/MSAdministrator/POSH-Guard/blob/master/Get-QualysAssetGroupInformation</a></a></p>

<p>We start of by opening up PowerShell ISE and using our handy &ldquo;Snippet&rdquo; shortcut:</p>

<p><a href="http://msadministrator.com/2016/02/03/powershell-qualys-get-asset-group-info-part-2/powershell_ise_ctrl__j/" rel="attachment wp-att-318"><img class="alignnone size-full wp-image-318" src="https://msadministrator.files.wordpress.com/2016/02/powershell_ise_ctrl__j.png" alt="PowerShell_ISE_CTRL_+_J" width="519" height="618" /></a></p>

<p>We select the &ldquo;Cmdlet (Advanced function) - complete&rdquo; option in the &ldquo;Snippet&rdquo; context menu.  Once we have our advanced function template, we then proceed by entering a name for our Qualys Asset Group function.</p>

<p>Since we will be gathering some additional information about our Asset Groups, I am going to name my function: [code
                    ]</p>

<p>function Get-QualysAssetGroupInformation</p>

<p>[/code
                    ]</p>

<p>Next, we will start by filling out our &ldquo;Help&rdquo; info.  At this point, a lot of people skip this step; I HIGHLY recommend that you do not.  It will help you and anyone else viewing your code, understand what your intention was when writing this function.</p>

<p>Next, we start by looking at our advanced functions template within the body of this function.  The first thing you will see is some default parameters for [CmdletBinding
                    ].  With my function, I&rsquo;m going to weed these parameters down a bit, as they are not really needed.  Your function should look something like this when complete: [code
                    ]
function Get-QualysAssetGroupInformation
{
                        [CmdletBinding(SupportsShouldProcess=$true,
                  HelpUri = &lsquo;https: //raw.githubusercontent.com/MSAdministrator/POSH-Guard/master/Get-QualysAssetGroupInformation&rsquo;,
                  ConfirmImpact=&lsquo;Medium&rsquo;)
                        ]
    [Alias()
                        ]
    Param
    (
        # Param1 help description
        [parameter(Mandatory=$true,
                   ValueFromPipeline=$true,
                   ValueFromPipelineByPropertyName=$true,
                   HelpMessage=&quot;Please provide a credential obejct&quot;)
                        ]
                   [ValidateNotNullOrEmpty()
                        ]
                   [System.Management.Automation.CredentialAttribute()
                        ]$credential
        )</p>

<pre><code>Begin
{}
Process
{}
End
{}
                }
</code></pre>

<p>[/code
                    ]</p>

<p>After we have the base of this function setup and ready to go, we will start off by adding some code into our Begin block.  Remember, the Begin block will always run once for every call to the function.</p>

<p>[code
                    ]
    $results = @()
    $assetGroupInfo = @()
        [xml
                    ]$assetGroupInfo = Invoke-RestMethod -Uri &quot;https: //qualysapi.qualys.com/msp/asset_group_list.php&quot; -Credential $credential [/code
                    ]</p>

<p>Here I am setting my $assetGroupInfo and a $results variable as empty array&rsquo;s/hash-table&rsquo;s. Next, I&rsquo;m casting my $assetGroupInfo variable as an XML object. This ensures that we receive XML from Invoke-RestMethod Cmdlet.</p>

<p>If we want to make sure that any errors are caught, we should add a Try/Catch block to our Invoke-RestMethod call. Your code should look like this: [code
                    ]
 Begin
    {
        $results = @()
        $assetGroupInfo = @()</p>

<pre><code>    Try
    {
                        [xml
                        ]$assetGroupInfo = Invoke-RestMethod -Uri &amp;quot;https: //qualysapi.qualys.com/msp/asset_group_list.php&amp;quot; -Credential $credential
                    }
    Catch
    {
        Write-Debug &amp;quot;Error using Invoke-RestMethod: $_&amp;quot;
                    }
                }
</code></pre>

<p>[/code
                    ]</p>

<p>Now we move to the Process block. This is where we will be parsing our data into our objects. As I mentioned above, we are wanting to gather all our Asset Groups Titles, their assigned IP Addresses, their role, and the users login ID. To do this, we must loop through each item, or branch returned by our query above. Each $item can be considered as an Asset Group. Additionally, we need to loop through each of the users assigned to that Asset Group.</p>

<p>Once we have that data, we want to create a Custom PSObject to hold all of this data. Your code should look like this: [code
                    ]
Process
{
    foreach ($item in $assetGroupInfo.SelectNodes(&quot;/ASSET_GROUP_LIST/ASSET_GROUP&quot;))
    {
        for ($u=0; $u -lt $($item.ASSIGNED_USERS.ASSIGNED_USER.LOGIN).count;$u++)
        {
            $tempAssetGroupInfo = @()</p>

<pre><code>                            $props = @{
            userlogin=$($item.ASSIGNED_USERS.ASSIGNED_USER[$u
                                ].LOGIN.InnerText)
            userrole=$($item.ASSIGNED_USERS.ASSIGNED_USER[$u
                                ].ROLE.InnerText)
                                       assetgrouptitle=$($item.TITLE.InnerText)
                                       ip=$($item.SCANIPS.IP)
                            }

        $tempAssetGroupInfo = New-Object PSObject -Property $props

                            $results += $tempAssetGroupInfo
                        }
                    }
                }
</code></pre>

<p>[/code
                    ]</p>

<p>Now, we can either simply put the following line in our End block: [code
                    ]
return $results
[/code
                    ]</p>

<p>But, I actually like it to be saved into an XML file. This means that I can use this data with other functions without having to call Qualys again. To be quite frank, as you may know, Qualys is not the fastest website/service out there. Don&rsquo;t get me wrong, the scanning engines are fast, but their database(s) - not so much.</p>

<p>To return both the object and export the results to an XML, we can just add this one line of code: [code
                    ]
Export-Clixml -Path &quot;$env:USERPROFILE\Desktop\QualysData\assetgroupinfo.xml&quot; -InputObject $results
[/code
                    ]</p>

<p>That&rsquo;s it. We now have a function that can return some details about our Asset Groups within Qualys. Next time, I will focus on creating a function that gathers our enrolled IP Addresses, split&rsquo;s them into a single list.</p>

<p>Hint: Qualys loves IP ranges (192.168.0.1-192.168.0.123) and their API calls return it the same way. :)</p>

    
     
    <div class="footer">
         
            <div class="tags">
                <i class="fa fa-tags"></i>
                <div class="links">
                    
                    <a href="/%20/tags/%20archive">archive</a>
                    
                </div>
            </div>
            
</div>

    
</article>
        
    </div>
    {0xc0001580e0 0xc000250a00}
    

     

        </div>

        <footer>
    <div class="container">
        <div class="recent-posts">
            <strong>Latest posts</strong>
                <ul>
                
                    <li>
                        <a href="/article/python-vs-powershell-part-1-versioning/">Python vs Powershell Part 1: Versioning</a>
                    </li>
                
                    <li>
                        <a href="/article/using-amazon-sns-with-powershell/">Using Amazon SNS With Powershell</a>
                    </li>
                
                    <li>
                        <a href="/article/how-to-setup-a-hugo-website-on-github/">How to Setup a Hugo Website on GitHub</a>
                    </li>
                
                    <li>
                        <a href="/article/using-amazon-sqs-with-powershell/">Using Amazon Sqs With Powershell</a>
                    </li>
                
                    <li>
                        <a href="/article/traverse-local-certificate-store-with-powershell/">Traverse Local Certificate Store With Powershell</a>
                    </li>
                
                    <li>
                        <a href="/article/powershell-scripts-functions-modules-cmdlets-oh-my/">Powershell Console, Scripts, Functions, Modules, Cmdlets, Oh My!</a>
                    </li>
                
                    <li>
                        <a href="/article/using-github-to-revive-blog-posts/">Using Github to Revive Blog Posts</a>
                    </li>
                
                    <li>
                        <a href="/article/connect-your-bot-to-slack/">Connect Your Bot to Slack</a>
                    </li>
                
                    <li>
                        <a href="/article/create-a-web-app-bot-using-azure-bot-services/">Create a Web App Bot Using Azure Bot Services</a>
                    </li>
                
                    <li>
                        <a href="/article/using-qnamaker-to-create-chatbot/">Using Qnamaker to Create Chatbot</a>
                    </li>
                
                </ul>
        </div>

        <div class="categories">
            <strong>Categories</strong>

            
                <ul>
                
                    <li>
                        <a href="/categories/automation">Automation (1)</a>
                    </li>
                
                    <li>
                        <a href="/categories/azure">Azure (4)</a>
                    </li>
                
                    <li>
                        <a href="/categories/how-to">How to (1)</a>
                    </li>
                
                    <li>
                        <a href="/categories/powershell">Powershell (7)</a>
                    </li>
                
                    <li>
                        <a href="/categories/python">Python (1)</a>
                    </li>
                
                    <li>
                        <a href="/categories/slack">Slack (1)</a>
                    </li>
                
                </ul>
            
        </div>

        <div class="right">
            
            <div class="social-media">
                <strong>Social media</strong>

                
                
                    <a href="https://twitter.com/MS_dministrator" target="_blank"><i class="fa fa-twitter"></i></a>
                
                
                
                
                
                
                
                
                
                    <a href="https://github.com/MSAdministrator" target="_blank"><i class="fa fa-github"></i></a>
                
                
                    <a href="https://www.linkedin.com/in/josh-rickard/" target="_blank"><i class="fa fa-linkedin"></i></a>
                
            </div>
            

            
        </div>
    </div>
</footer>

<div class="credits">
    <div class="container">
        <div class="copyright">
            <a href="https://github.com/Lednerb" target="_blank">
                &copy;
                
                    2018
                
                by Lednerb
            </a>
	    -
	    
        </div>
        <div class="author">
            <a href="https://github.com/Lednerb/bilberry-hugo-theme" target="_blank">Bilberry Hugo Theme</a>
        </div>
    </div>
</div>

        
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-35980408-2"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments) };
    gtag('js', new Date());

    gtag('config', 'UA-35980408-2');
</script>


        

        <script src="https://letsautomate.it/dist/theme.js" type="application/javascript"></script>

        
            
        

        <script>
            $(document).ready(function() {
                $(".moment").each(function() {
                    $(this).text(
                        moment( $(this).text() )
                            .locale( "en" )
                            .format('LL')
                    );
                });

                $(".footnote-return sup").html("[return]")
            })
        </script>

        
            <script>
    var client = algoliasearch("NLP9E0F1NO", "a4ffdf988b82857fa86f4403da30ec7f");
    var index = client.initIndex("prod_msadministrator");

    $('#search').autocomplete({ hint: false, autoselect: true, debug: false },
      [
        {
          
            source: $.fn.autocomplete.sources.hits(index, { hitsPerPage: 5, filters: 'language: en' }),
          
          displayKey: function(suggestion) {
            return suggestion.title || suggestion.author
          },
          templates: {
            suggestion: function(suggestion) {
                return "<span class='entry " + suggestion.type + "'>"
                      + "<span class='title'>" + suggestion.title + "</span>"
                      + "<span class='fa fa-fw " + suggestion.iconClass + "'></span>"
                  + "</span>"
                ;
            },
            empty: function() {
              return "<span class='empty'>Nothing found.</span>"
            },
            footer: function() {
              return '<div class="branding">Powered by <img src="https:\/\/letsautomate.it\/dist\/algolia-logo-light.svg" /></div>'
            }

          },
        }
      ])
      .on('autocomplete:selected', function(event, suggestion, dataset) {
        window.location = (suggestion.url);
      })
      .keypress(function (event, suggestion) {
        if (event.which == 13) {
          window.location = (suggestion.url);
        }
      });
</script>

        


    </body>
</html>
